# 第 4 章 各种更新机制的安全指导意见

下文提供了关于针对三种典型的安全 BIOS 更新机制实施本文档中的安全指导意见的详细建议。一台服务器可以实施这些机制中的一种或多种，而一台给定的服务器上所实施的方法可能由该平台上的硬件支持所决定。这些方法会因 RTU 可以于何时被建立以及用于防止对于存储于 BIOS 闪存存储器中的代码和数据的无意或者恶意的修改的闪存安全锁定机制的可用性而异。所有机制依赖于经过数字签名的 BIOS 更新镜像以及 RTU 中的验证组件利用某个公钥以验证该镜像的签名的能力。

## 4.1 更新机制 1：任何时机的安全 BIOS 更新

对于此种 BIOS 更新机制，对 BIOS 闪存存储器的安全更新可能发生于服务器的多种运行状态。这包括能够在服务器运行时更新 BIOS 闪存而无需重启。尽管新的 BIOS 被期望直到重启之前不会被执行，此闪存可以在运行时使用系统管理中断（SMI）处理程序、服务处理器或者其他安全方法来刷新。导致新 BIOS 被执行的重启可以发生于任何后续时机（在实际的闪存更新发生之后潜在地可达数月之久）。

由于此安全更新机制防止向 BIOS 闪存存储器写入非法代码，无需在重启时验证 BIOS。

对于实施此种 BIOS 更新机制的相关指导意见列于下方：

* BIOS 更新镜像必须经过数字签名以满足 3.1 节所述的 BIOS 更新认证要求。实现方式可以将 BIOS 更新镜像分割为多个独立数字签名的部分
* 如 2.5 节定义的 RTU 必须在运行时可用（并且可以在服务器的其他运行状态下可用）以更新 BIOS 闪存存储器
* 锁定机制必须存在以使得只有 RTU 可以写入 BIOS 闪存。应该只有 RTU 能够解锁闪存，并且当解锁时，只有 RTU 可以拥有写入 BIOS 闪存存储器的能力。RTU 可以总是拥有 BIOS 闪存存储器的写入访问权限
* 经过数字签名的 BIOS 更新镜像必须被传输到 RTU。RTU 必须有能力将 BIOS 更新镜像存储于某个不允许对 BIOS 更新镜像进行非授权的写入访问的位置。

实施这一机制的一般步骤包括：

1. 经过数字签名的 BIOS 更新镜像被传输到 RTU
2. RTU 将此 BIOS 更新镜像存储于只能被 RTU 写入的某个位置
3. RTU 验证此 BIOS 更新镜像是否合法。如果此 BIOS 更新镜像被确定为非法，则此 BIOS 更新镜像不会被写入 BIOS 闪存存储器。如果此 BIOS 更新镜像合法，RTU 配置锁定机制，使得只有 RTU 拥有对于 BIOS 闪存存储器的写入访问权限。可行的锁定机制设计可以允许 RTU 对于 BIOS 闪存存储器总是拥有写入访问权限，只要只有 RTU 拥有相同的能力
4. RTU 将 BIOS 更新镜像写入 BIOS 闪存存储器
5. RTU 保证 BIOS 闪存存储器在将控制权移交给 RTU 以外的代码（例如 Option ROM）之前被锁定，基于 3.3 节所述的固件完整性保护的每一项要求。

参见附录 B 以获取此更新机制的范例。

## 4.2 更新机制 2：重启时的安全 BIOS 更新

对于此种 BIOS 更新机制，BIOS 闪存存储器处理在服务器运行时被引发，然而实际的 BIOS 闪存存储器更新直到服务器重启之前都不会发生。此种 BIOS 更新机制防止非法代码被写入 BIOS 闪存存储器中。

对于实施此种 BIOS 更新机制的相关指导意见列于下方：

* BIOS 更新镜像必须经过数字签名以满足 3.1 节所述的 BIOS 更新认证要求。实现方式可以将 BIOS 更新镜像分割为多个独立数字签名的部分
* 对于 BIOS 闪存存储器的锁定机制必须存在，使得除了 RTU 以外没有任何实体在运行时对于 BIOS 闪存存储器拥有写入访问权限。尽管对于此种更新机制，RTU 不必须拥有对于 BIOS 闪存存储器的写入访问权限，可能还有确实有此要求的其他 BIOS 更新机制被支持
* 如 2.5 节所定义的 RTU 必须在系统启动过程中可用，它可以在运行时更新 BIOS 闪存存储器。RTU 必须在重启时在 BIOS 闪存存储器更新之前被执行。RTU 将会在针对闪存的任何更改发生之前验证 BIOS 更新镜像的数字签名
* 必须存在一块其内容在重启时可被保留的存储区域，使得经过签名的 BIOS 更新镜像可以于运行时被缓存到其中，并且 RTU 可以在重启过程中访问它以便在更新 BIOS 闪存存储器的内容之前验证 BIOS 更新镜像的数字签名。在重启过程中，保存 BIOS 更新镜像的存储区域在验证过程中必须不能被除了 RTU 以外的任何实体访问。

实施这一机制的一般步骤包括：

1. 经过签名的 BIOS 更新镜像被缓存到一块存储位置，其内容可以在服务器重启时被保留
2. 当服务器重启时，执行权被移交至 RTU
3. RTU 验证 BIOS 更新镜像是否合法。如果认定为合法，RTU 将会按需解锁 BIOS 闪存存储器并且将更新写入 BIOS 闪存存储器。如果此 BIOS 更新镜像被认定为非法，则 BIOS 闪存存储器不会被更新
4. BIOS 闪存存储器的锁定机制在执行任何不可信代码，包括 Option ROM 之前被启用。

参见附录 C 以获取此更新机制的范例。

## 4.3 更新机制 3：要求启动时验证的安全 BIOS 更新

对于此种更新机制，在运行时保护 BIOS 闪存存储器的锁定机制不存在或者受限，使得由 RTU 以外的实体对 BIOS 闪存存储器的写入不能被防止。对 BIOS 闪存存储器的恶意更新可能会发生，由于 BIOS 闪存存储器未被写保护或者锁定。然而，BIOS 闪存存储器的内容应该于每次启动时被执行前被认证。如果 BIOS 闪存存储器在启动过程中被认定为非法，将会引发恢复过程，而非法 BIOS 不会被执行。

对于实施此种 BIOS 更新机制的相关指导意见列于下方：

* BIOS 镜像必须经过数字签名，以满足 3.1 节所述的 BIOS 更新认证要求
* 如 2.5 节所定义的 RTU 必须在将镜像写入到 BIOS 闪存存储器之前验证 BIOS 更新镜像的数字签名
* 由于系统 BIOS 在运行时未被保护以防止修改，RTU 必须包含能够在执行之前验证系统 BIOS 的验证组件，基于 3.3 节所述的固件完整性保护的每一条要求。验证组件必须在启动时被执行，并且在任何可更新的 BIOS 代码被执行之前验证系统 BIOS
* 如果系统 BIOS 被认定为非法，RTU 必须引发恢复过程，并且非法系统 BIOS 必须从未被执行。

实施这一机制的一般步骤包括：

1. 经过数字签名的 BIOS 镜像被验证并且写入到 BIOS 闪存存储器中
2. 在每次启动时，执行权被移交给 RTU
3. 如果 RTU 的验证组件认定 BIOS 闪存存储器合法，执行权被移交给 BIOS
4. 如果 BIOS 闪存存储器被认定为非法，RTU 引发恢复过程，并且此非法 BIOS 从未被执行。

参见附录 D 以获取此更新机制的范例。

