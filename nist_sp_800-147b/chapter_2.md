# 第 2 章 背景

本章提供了关于系统 BIOS 和服务器架构类型的背景信息。它标识出了用于更新系统 BIOS 的主要方法，还讨论了系统 BIOS 的安全问题和威胁。最后，本章讨论了更新可信根的组件。

## 2.1 系统 BIOS

系统 BIOS 完全由那些可以被嵌入平台的硅基组件，例如处理器中的特定配置和安全代码组成。它是当计算机加电时在其主中央处理器（CPU）上所执行的首个软件。尽管系统 BIOS 最初负责为操作系统提供硬件访问，它在现代设备上的主要作用是初始化并且测试硬件以及加载操作系统。此外，BIOS 加载并初始化重要的系统管理功能，诸如电源和散热管理。系统 BIOS 还可以在启动过程中加载 CPU 微码补丁。

有若干种不同类型的系统 BIOS 固件。某些计算机使用 16 位的传统 BIOS，而众多较新的系统使用基于 UEFI 规范 \[UEFI\] 启动固件，或者使用其他自定义的启动固件。在此文档中，我们将所有类型的启动固件称为 BIOS 固件、系统 BIOS 或者简称为 BIOS。如有必要，我们将会这样将传统 BIOS 固件同 UEFI 固件区分开来，即分别称其为传统 BIOS 和 UEFI BIOS。

系统 BIOS 通常由服务器的原始设备制造商（OEM）开发。制造商频繁更新系统固件以修复 bug、为漏洞打补丁，以及支持新硬件。系统 BIOS 通常存储于电可擦除可编程只读存储器（EEPROM）或者其他类型的闪存存储器中。通常，系统 BIOS 固件由一种对于 BIOS 所存储于其中的非易失性存储组件具有特别知识的工具来更新。此工具可以运行在服务器本身的 CPU 之一上，也可以运行在服务器机箱内的一块管理服务器上。

一台给定的计算机系统可能在若干不同位置上拥有 BIOS。除了主板以外，BIOS 也可以在硬盘控制器、显卡、网卡及其他扩展卡上找到。这些额外的固件通常采用 Option ROM 的形式（包括传统 BIOS 和/或 UEFI 驱动程序）。它们在启动过程中由系统固件加载，并且在宿主 CPU 上执行。Option ROM 不应与设备固件相混淆；服务器中有众多带有运行其自身固件的微控制器的系统设备。

此文档中的指导意见适用于存储在 BIOS 闪存存储器中的 BIOS 固件，包括 BIOS 代码、作为更新可信根的一部分的密码学密钥，以及静态 BIOS 数据。与系统 BIOS 固件一同存储并且以相同机制更新的 Option ROM 出于此文档的目的也被看作 BIOS 的一部分。然而，这些指导意见并不适用于存储于服务器的其他位置，诸如一块扩展卡上的 Option ROM 及其他设备固件。

如需获得关于系统 BIOS 基础的更多信息，查阅 NIST SP800-147 第 2 章。

## 2.2 服务器架构

在本节中，我们将服务器分为三类：基本服务器、受管理的服务器和刀片服务器。此处所作出的区分必须与更新系统 BIOS 所采用的机制相关。

**基本服务器**在架构上类似于拥有单一 BIOS 更新机制的客户端 PC 系统。为基本服务器保护 BIOS 更新的要求可以通过符合列出于此文档或者 NIST SP800-147 第 3.1 节的要求而被满足。通常，基本服务器上的更新可信根（RTU）是系统 BIOS 的一部分（参见 2.5 节以获得关于 RTU 的更多信息）。

**受管理的服务器**是拥有用于设备维护和额外服务器管理特性的专用通道的计算机系统。除了宿主处理器外，受管理的服务器可能拥有能够进行系统管理，可能包括 BIOS 更新的服务处理器（见下文）。防止在服务处理器上执行恶意或者损坏的代码至关重要，由于它对于服务器的其他操作方面拥有直接控制权。作为一种潜在的 BIOS 更新机制，执行于服务处理器上的代码可能包含 RTU 并且必须被保护起来以防止非授权的修改。

**刀片服务器**是一种专用的服务器硬件平台设计，它被配置为可安装于机架系统中的机箱/机柜中的可装配设备。这些平台通常拥有共享的电源和冷却系统以及共享的管理接口。刀片可以在一个机箱/机柜/机架内作为一排服务器自主地运作，或者由中央总线管理器控制。这种系统配置也可能拥有多种途径以更新用于运行独立刀片的 BIOS。从 BIOS 更新的视角来看，刀片服务器通常类似于受管理的服务器。业界也会使用多节点（或者模块化）服务器这一词语，它们拥有和刀片服务器相同的 BIOS 保护要求。

不同的服务器架构差别巨大，尽管大多数服务器适合于归入上述类别之一，在某些情况下，可能难于将一台服务器严格归类为属于上述类别之一。这些类别被作为范例而提供，以帮助澄清要求。然而此文档中的安全指导意见的本意是对任意类型的服务器拥有宽泛的可适用性。

一台服务器可能拥有一块服务处理器，有时称为基板管理控制器，这是一种专用的微控制器。服务处理器通常是一块特别的扩展卡，或者嵌入于服务器主板之上。服务处理器微控制器运行一种专用的操作系统，通常存储于闪存存储器中，并且为管理员提供接口以管理宿主服务器。服务处理器通常是现代服务器中的高权限组件，通常能够更新系统上的固件和软件、更改配置设置，以及读取系统内存。此文档假设管理员将会实施适当的计算机、网络和物理安全性控制以化解对于服务处理器的特有威胁。例如，管理员通常通过网络接口与服务处理器进行交互。最佳安全实践表明，服务处理器应该处于只能由系统管理员访问的私有局域网中。

服务处理器负责执行不同功能，取决于系统实现。服务处理器通常将会监视服务器中的不同传感器，例如用于散热和电源管理的温度和电源传感器。它可能会为管理员提供某种机制以更新服务器和宿主操作系统中的软件或者固件。维持服务处理器的安全对于维持服务器的完整性和可用性至关重要。参见第 5 章以获得关于服务处理器的安全要求。

## 2.3 系统 BIOS 更新机制

此出版物中的指导意见的本意是防护 BIOS 更新机制以使得只有合法的、经过授权的 BIOS 镜像被写入 BIOS 闪存存储器。这一过程有时被称为“刷”镜像。尽管客户端系统通常只有一种途径以更新 BIOS，服务器系统可能实施若干种更新机制以允许管理员在不同环境中更新 BIOS。此出版物标识了三种一般类别的认证 BIOS 更新机制。一台服务器通常将会实施这些更新机制中的一种或多种。每种更新机制简略描述如下：

* **更新机制 1——可于任何时机发生的认证 BIOS 更新**：此更新机制允许 BIOS 闪存存储器被安全地更新，而无论服务器的操作状态。这包括能够在服务器运转时更新 BIOS 闪存而无需重启。此机制必须保护 BIOS 闪存存储器以防止非授权的修改。
* **更新机制 2——重启时的认证 BIOS 更新**：此 BIOS 更新机制允许在服务器运行时期间引发刷新过程，但是对 BIOS 闪存存储器的实际更新直到系统重启时才会发生。与上一种机制类似，此机制必须保护 BIOS 闪存存储器以防止非授权的修改。
* **更新机制 3——运行时的 BIOS 更新和重启时的 BIOS 验证**：利用这种 BIOS 更新机制，BIOS 只有在每次启动时被验证为合法才能被执行。此机制是必需的，如果 BIOS 刷新锁定机制不足以保护运行中的系统的 BIOS 闪存存储器的完整性。如果 BIOS 闪存存储器在启动时被确定为非法，将会引发恢复过程，并且非法 BIOS 不会被执行。

此外，某些服务器可能包含一种安全本地更新机制，它可以更新系统 BIOS 而无需使用上文讨论的三种认证更新机制中的任何一种。安全本地更新机制通过要求一位管理员物理存在于服务器面前指导更新来保证 BIOS 更新镜像的合法性和完整性。对物理存在的要求化解了针对系统 BIOS 的远程攻击的风险。

## 2.4 针对系统 BIOS 的威胁

服务器容易受到和那些对客户端系统构成威胁的相同形式的攻击。在服务器上执行操作系统层级的恶意软件可能先于 BIOS 攻击发生。未经认证为来自可信来源就执行的服务器 BIOS 更新易受攻击。由于服务器可能拥有多种 BIOS 更新机制，每种机制都有存在漏洞的风险。不同更新机制之间的相互作用还可能潜在地引入其他漏洞。

服务器中的服务处理器拥有提升的权限以执行系统管理，这可能包括修改 BIOS。尽管服务处理器可能是通过隔离的通讯信道被控制的，对此信道的非授权访问使服务器暴露于重大风险之中。尽管众多安全实践专注于数据网络，在没有为之付出特别努力的情况下，管理网络可能被较少地审查和保护。

如果保护不充分，服务器上的 BIOS 镜像备份（通常是为了恢复特性而保留的）容易受到重写攻击，即使主要 BIOS 被保护以防止修改。在成功破坏一份 BIOS 备份之后，对手可以利用其他手段以使得服务器通过受感染的备份镜像重启。

## 2.5 更新可信根

更新可信根（RTU）是被内在地信任的硬件和固件的组合，它执行安全 BIOS 更新并且维持 BIOS 的完整性。RTU 可能包括验证经过数字签名的 BIOS 镜像、启用或禁用写保护机制、将 BIOS 更新写入到闪存、执行 BIOS 恢复，以及更新 RTU 本身等功能。第 3 章具体说明执行安全 BIOS 更新和维持 BIOS 完整性对于 RTU 的要求。对 RTU 的内在信任是从隔离的执行环境中得到的——最小化破坏 RTU 功能的风险并且因此维持对 RTU 的内在信任。

RTU 的每种功能组件可以被看作用于该特定功能的可信根：

* **验证组件**负责验证经过数字签名的 BIOS 镜像以决定是否应该将控制权传递给该镜像。该组件拥有可信执行途径，由于它是从设备的一种已知正确的状态进入的。验证组件可用于将可信执行延伸到未受保护的内存区域中的代码上来。验证组件将会验证 BIOS 镜像，如果验证成功，则将控制权传递给该镜像。如果验证失败，则验证组件返回可信执行环境并且不将控制权传递给该镜像。
* **恢复组件**负责引发系统返回至一种已知正确的状态。
* **完整性组件**负责维护 BIOS 镜像的完整性。这可能包括启用基于硬件和固件的锁定机制以防止对镜像的非授权修改。它也会防止竞争/逻辑条件对 BIOS 镜像进行非授权修改。
* **更新组件**负责执行安全 RTU 更新以及维持 RTU 的完整性。

