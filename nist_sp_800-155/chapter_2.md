# 第 2 章 背景

诸如台式机和笔记本等客户端计算机包含用于辅助硬件初始化过程的程序代码。这些代码存储于非易失性存储器中，并且通常称为 _启动固件_。用于初始化系统的首要固件称为 _基本输入/输出系统_（_BIOS_）或者 _系统 BIOS_。如果 BIOS 从它的预想状态发生更改，不论是恶意还是无意，它所发生更改的设备可能会对组织机构产生负面影响，由于该设备不一定是以其预想状态运行的。可能的结果包括系统不稳定、系统故障、信息泄露，或是其他可靠性、完整性和可用性的丧失。此外，此系统可能易受更加精妙的攻击，诸如隐秘监控，并且攻击者可以将此系统用作攻击其他系统的基石。这些范例解释了为何通过测定和监测其完整性以检测针对 BIOS 及其配置的更改如此重要。

本章提供了关于 BIOS 完整性测定（BIM）的概述及其在组织机构检测、报告和化解操作环境中的针对 BIOS 的攻击中的作用。本章标识出了完成此任务所要求的主要组件并且对这种方法论所能解决的威胁进行了描述。

## 2.1 BIOS 完整性测定场景

本节呈现了那些定义了候选应用案例的场景，这些场景将会引导要求和建议在此文档的剩余部分中的呈现。这些应用案例用作识别用户操作、相关通讯、内在风险以及潜在的安全防护的基础。

这些场景基于 IT 组织机构在 BIM 领域的客观状态和过程成熟度。在很大程度上，这种客观状态近似地反映出了众多组织机构当今在终端机的补丁管理领域所使用的最佳实践。具体地，组织机构可以期望对于新的终端机实施这样一种供货过程，在这里，BIM 被完全整合进此模型中。例如，供货一台终端机将会包含这些额外的与 BIOS 完整性具体相关的活动，这些活动可以与现存的镜像、财产跟踪以及注册活动等互补。

* 为一台给定的客户端安装并且/或者验证正确的 BIOS 修订版本
* 利用适当的 BIOS 设置对该 BIOS 进行镜像
* 设置 BIOS 口令
* 主张任何要求物理存在的安全控制（可能包含可信平台模块（TPM））
* 将此终端机的身份和完整性度量注册到相关的 IT 数据库

这些安全变量中的任何更改可能提示一种异常状态，以及潜在地更具危险性的效应。当今存在的客户端操作系统代理在网络管理层上报告关于这些设置的基本信息，并且它们是用于评估 BIOS 安全状态的良好的初始工具。然而，每当可能时，这些报告代理需要立即被迁移到依赖于植根于防破坏的可信根的完整性基础设施上来。

### 2.1.1 场景 1：系统 BIOS 发生某些更改

针对客户端计算机的 BIOS 更新频繁发布。这些更新通常修复电源管理子系统、硬盘或网络管理，或者其他重要组件中的 bug。然而，BIOS 也可能出于恶意目的被修改。系统管理员能够分辨哪种版本的 BIOS 在一台设备上被加载以便能够正确地管理它是至关重要的。这必须在面对如下基本挑战的同时完成：

* IT 管理部门必须能够信任所采集到的 BIOS 固件测定数据是正确的
    * 需要有一个可信根以信任 BIOS 固件完整性测定数据的采集
    * 关于 BIOS 固件的完整性测定数据的有效初始基线必须被采集，可以潜在地使用该设备的可信根以采集并报告基线测定数据
    * BIOS 固件完整性测定数据必须是可证明地新鲜的（其响应不能仅仅是某次较早的正确响应的重演）
    * BIOS 固件完整性测定数据必须拥有可证明的完整性（它在响应者和接收者之间未被更改）
    * BIOS 固件完整性测定数据的来源必须被确定（它来自 IT 部门所认为它来自的地方）
* IT 管理部门必须能够解读被报告的 BIOS 固件完整性测定数据
    * 标准格式至关重要
    * 需要考虑系统的多样性
* 用户和管理员必须能够知道 BIOS 在何时发生更改，而无需徒手进行庞杂的计算。

### 2.1.2 场景 2：BIOS 配置设置发生某些更改

BIOS 设置对于系统安全性具有重大影响，需要回答的关于设置的部分问题列表包括：

* 口令
    * 管理员口令是否被设置？
    * 开机口令是否被设置？
    * 硬盘口令是否被设置？
* 基于 BIOS 的管理（BBM）软件
    * 是否被启用？
    * 基于 BIOS 的管理软件的配置是什么？
* 启动
    * 启动顺序是否发生更改？
    * 计算机是否会从除硬盘外的任何位置启动？
* 端口和其他硬件接口
    * USB 端口是否被启用？
    * 1394 端口是否被启用？
    * PCMCIA 或者智能卡读卡器是否被启用？
    * 近场通讯（NFC）端口是否被启用？

这些设置发生的任何更改可能指示系统已经变得不那么安全，或者已被攻击。与第一种场景类似，用户和管理员都能确定 BIOS 设置是什么以及它们是否符合策略是至关重要的。此文档要求那些允许管理员辨别 BIOS 配置设置是否被更改的能力，并且鼓励使用那些允许管理员区分哪些设置被更改的能力。

识别 BIOS 配置更改要求以下能力，与识别 BIOS 代码更改所需的能力类似，但是对其进行了扩展：

* IT 管理部门必须能够信任 BIOS 配置的完整性测定数据是正确的
    * 需要有一个可信根以信任 BIOS 配置的完整性测定数据
    * 测定数据必须是可证明地新鲜的
    * 测定数据必须拥有可证明的完整性
    * 测定数据的来源必须被确定
* IT 管理部门必须能够解读响应
    * 标准格式至关重要
    * 需要考虑系统的多样性

## 2.2 BIOS 完整性测定流

为了测定 BIOS 的完整性，某些基本要求必须被满足，它们包括：

* 生成并采集测定数据的方法
* 存储测定数据的方法，它要么是能够抵抗破坏的，要么是能够使破坏显而易见的
* 将测定数据传输到分析代理的方法
* 分析测定结果的方法，以及基于此测定结果管理一台设备的方法

终端机设备必须拥有能够测定 BIOS 固件并且将这些测定数据转发至管理权威机构的方法。此终端机必须在执行此任务的同时保护这些测定数据的完整性、合法性、不可抵赖性，以及在某些情况下还有机密性。

图 1 显示了支持 BIM 的生成、转发、分析，以及基于此分析的补救行为的架构。这些解决方案可以由单一厂商提供，或者由多家厂商联合提供。在终端机上，用于测定、存储和报告的可信根构成了提供必要的安全服务的基础。3.1 节将会在更深的层次上涵盖可信根。

> 图 1：BIOS 完整性架构

BIOS 代码和配置数据代表测定目标。测定数据生成和报告代理作用于测定目标并且直接撬动可信根以便为每一次测定以及测定和报告过程提供安全防护。3.2 和 3.3 节为测定和与之关联的过程提供了更多见解。采集和传输代理提供了一种方法以可靠地采集测定数据并且将其传输至测定数据评估权威机构（MAA）以进行进一步分析。3.4 和 3.5 节讨论这些代理的功能。3.6 节讨论的恢复代理为管理权威机构提供了一种方法以采取行动来修复通过 BIOS 测定数据分析在终端机上发现的任何问题。

在评估测定数据时，MAA 参考一组特征。这些特征集合分为两类：要么是终端机属性和 BIOS 代码的测定数据，它们由原始设备制造商（OEM）、增值分销商（VAR）或者独立软件厂商（ISV）提供并且担保（利用证书），要么是配置设置的测定数据，它们由终端机的用户/管理员在该终端机的最初供货阶段采集，或者由 MAA 采集。理想的测定数据特征的集合称为 _黄金测定数据_。

MAA 可以托管若干种服务，诸如管理控制台或者一种提供简易用户界面以分析 BIOS 属性和测定数据的控制面板，以允许管理员或者分析者快速确定以下方面：

* 终端机设备的报告的可信度
* 设备是否符合要求（与当前的一套黄金测定数据相匹配）
* 设备是否需要恢复（BIOS 设置不符合要求，或者正在使用老旧的黄金测定数据）
* 设备是否潜在地具有危险性（某些测定数据已知能够指示恶意活动）

基于这些报告，设备可以被允许或者拒绝访问资源（例如，允许访问网络资源、允许受限访问网络资源，诸如恢复网络，或者拒绝访问），这些报告也可触发其他管理行为。

图 1 描述了 BIOS 完整性测定和报告的典型数据流：

1. 获取一套初始的可信测定数据（黄金测定数据）。这些测定数据要么由第三方（例如 OEM）向 MAA 提供，要么由系统管理员在初始供货时生成
2. 在终端机的启动过程中，在植根于测定可信根（RTM）的信任链中由固件对 BIOS 固件及其配置设置进行一系列测定。RTM 存储这些测定数据的散列值表征，这些测定数据由存储可信根（RTS）存储或保护。一段可以根据它重建这些测定数据的日志存储于内存中的某处，以使得传输代理可以重建这些测定数据
3. 作为对终端机请求服务或者 MAA 请求行为的响应，MAA 生成一次测定请求，包含一个临时随机数。传输代理接收此请求，确定它属于 BIOS 完整性测定，并且因此将其传输至采集代理
4. 采集代理对请求进行语法检查，并且将临时随机数传输至报告代理，后者利用报告可信根（RTR）以获取此临时随机数的签名以及所存储的测定数据的散列值表征
5. 报告代理将此数据（连同从内存中获取的日志）传输回采集代理
6. 采集代理将此数据格式化为标准格式，并且将其传输回传输代理
7. 传输代理将此数据传输至 MAA 的验证代理
8. 验证代理验证散列值的签名，通过验证用于签名这些散列值以及签名本身的公钥，以及验证报告中包含的临时随机数与测定请求中发送的临时随机数匹配。它随后将这些签名的测定数据与它早先获取的黄金测定数据进行比较
9. 在这种比较的结果与来自其他设备的类似比较结果相核对之后，可以将其通过某个用户界面（诸如管理控制台或者控制面板）显示给管理员并且/或者提供给某个自动化的强制执行/访问点
10. 如果此结果被提供给某个自动化的强制执行/访问点，管理员或者其代理随后根据比较的结果作出决定，这可能是允许或者拒绝网络访问、发送信号至恢复代理，或者也可能是派遣一位服务技术人员到该设备以确定得到错误结果的原因。

## 2.3 过渡到理想状态

对于 BIM 的理想或者客观状态，BIOS 测定是程式化和自动化的客户端扫描的一部分。随着组织机构从它们当今所处的状态逐步进步到理想状态，必须迈出若干步骤。最初，这些测定数据只会随着其他客户端健康数据一同采集和存储。这些数据随后将会在常规的基础上被审阅和分析，以开发出一种关于组织机构内部的客户端 BIOS 的基线行为的理解。随着控制面板套件和其他操作工具被更新以便将 BIOS 完整性信息整合为第一级数据，用于 BIM 的附属活动和责任可以被移交给标准 IT 操作团队。随着时间进展，这又会简单地成为 IT 服务的另一个标准职位。

