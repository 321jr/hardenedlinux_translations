# 第 1 章 简介

应用容器正在生产环境中逐渐得到采用，由于下列优势：较短的开发和部署周期，通过轻量级虚拟化而实现的资源效率，以及用于所涉及的过程的自动化的工具的可用性。为了解决这些环境中的安全性问题，_应用容器安全性指南_（美国国家标准技术研究所（NIST）特别出版 800-190）\[1\]（在此文档的剩余部分中被引用为 _容器安全性指南_）一文标识出了针对托管容器的平台的组件以及在启动之前构建容器并且存储它们的过程所涉及的与之相关联的东西的安全性威胁。考虑到对于涉及容器的整个生态系统的总体性的安全性启示，_容器安全性指南_ 一文也提供了用于 6 种实体，以及通过它们实施的安全性反制措施，包括硬件、宿主操作系统（OS）、容器运行时、镜像、注册表和编排器。

为了实施这些反制措施，需要一种或者更多种安全性解决方案。此文档讨论了能够提供反制措施所必需的功能的潜在的安全性解决方案，以及每一种安全性解决方案所应该满足的安全性担保要求的类型。这些安全性解决方案可以被宽泛地分类为：

* (a) 用于提供启动过程完整性的基于硬件的可信根
* (b) 使用宿主 OS 内核特性和内核可加载模块的配置选项
* (c) 用于构建和存储容器镜像的保护措施
* (d) 用于发布涉及多个容器和多个宿主的生产基础设施的编排器工具的配置选项

此文档的目的是在其被设计为去满足的安全性目标的上下文环境中检视每一种安全性解决方案，以及开发那些它们应该满足以使其有效的担保要求。被考虑的宿主 OS 是 Linux，由于以下原因：

* (a) 其在容器栈中的广泛采用
* (b) Linux 发行版是开源的，并且允许足够多的与安全相关的信息成为公共可用的

## 1.1 此文档的范围

容器技术栈的功能架构框图如图 1 所示。在此框图中，此栈由物理宿主（或者虚拟机（VM））、容器 OS（我们将会在此文档中将其引用为宿主 OS）、容器运行时，以及多个容器组成。此外，诸如下列任务全部由多种工具执行，并且被整合到编排器软件的整体控制之下：创建虚拟网络以便在容器宿主内部以及它们之间将容器连接起来（容器网络）、创建容器宿主集群（容器集群管理）、创建路径程序以便识别并且发现某个提供某种特定服务的特定容器（服务发现）、跨集群容器计划（容器计划），以及在不同容器内部计划特定的业务应用程序（应用程序计划）。在不同的容器宿主上将其作为容器实际启动起来之前，首先利用适当的开发工具创建一系列组件的模板，这些组件构成了一个称为容器镜像的容器。这些容器镜像被存储于容器注册表中（镜像管理）并且随后被推送至容器宿主并且利用容器运行时工具将其作为容器启动起来。容器运行时同时提供接口以用于配置宿主 OS 参数，以及与内核可加载模块相关联的设置以允许不同容器的安全部署。

> 图 1——容器技术栈

如图 1 所示，安全功能层跨越了容器技术栈的所有功能层。然而，覆盖了这些层的安全性解决方案必须通过下列组件来实现：

* (a) 物理宿主（即硬件，由于托管于 VM 之上的容器超出了此文档的范围）
* (b) 容器 OS（宿主 OS）接口
* (c) 容器运行时接口
* (d) 镜像管理和注册表接口
* (e) 编排器接口

运行于容器栈中的容器可以是系统容器或者应用容器。其行为类似于完整的 OS 并且运行诸如 `sshd`（安全会话建立）以及 `syslogd`（日志能力）的程序的容器称为系统容器。而仅仅运行应用程序的容器称为应用容器 \[2\]。此文档专注于应用容器。在分析安全性解决方案以及它们所应该满足的担保要求之前，有必要叙述应用容器的执行模型以及假想的攻击模型。首先，应用程序在容器中作为单一的操作系统进程而运行。容器拥有应用程序代码本身以及软件栈（包括二进制文件和库）的副本 \[3\]。在大多数情况下，此栈可以利用某种类型的库系统组装起来，从而避免需要由开发者来从头构建和配置该栈。这种快速组装的栈在不同的容器产品供应中被赋予了不同的名称（例如建构包（buildpack）、墨囊（cartridge）等）。有一些栈被用于众多的流行编程语言运行时，诸如 Java、PHP、Node.js 和 Ruby 等。对于特殊的应用程序，开发者可以创建他们自己的自定义的栈。容器架构的部署模型可能涉及在独立的容器中并行运行相同应用程序的副本，甚至是跨越不同的容器的宿主。在此场景中，基础设施可能拥有某种机制以利用某种形式的负载均衡将传入的请求分布至同一应用程序的所有实例。

此处假想的攻击模型是，容器中的应用程序代码的漏洞或者错误配置（例如此容器被配置为运行于高权限模式）已经被攻击者利用。这将会允许攻击者获得对于容器运行时以及宿主 OS 内核中的高权限代码的控制权并且对其进行攻击，在此，后者被容器中的应用程序代码信任以提供诸如进程隔离等一些保护担保 \[4\]。此类攻击的一个范例是重放、录制、修改和丢弃某个网络包或者文件系统访问。此文档中讨论的安全性解决方案的本意是防止对于容器运行时和宿主 OS 的此类攻击。关于解决应用程序代码本身的内在不安全特性，诸如编程 bug、设计瑕疵或者执行模型等的解决方案超出了此文档的范围。

## 1.2 文档结构

此文档的剩余部分被组织进下列章节和附录中：

* 第 2 章提供了关于不同的 Linux 内核特性（名称空间、控制组（Cgroups）、能力）以及内核可加载模块在为容器化的栈提供安全性中的功能的概述
* 第 3 章描述了用于容器环境的基于硬件的安全性解决方案
* 第 4 章概述了宿主 OS 保护措施以及与之相关联的担保要求
* 第 5 章详细呈现了若干种容器运行时配置解决方案，用以为下列事物提供容器隔离：进程、文件系统、进程间通讯（IPC）以及网络。本章还呈现了关于限制资源以及保证最小化权限的解决方案。所有解决方案都得到了分析，并且还呈现了一组必须被满足的担保要求
* 第 6 章定义了用于构建和维护容器镜像的担保要求
* 第 7 章简要讨论了用于容器注册表保护的担保要求
* 第 8 章概述了用于编排器工具的基本安全性担保要求
* 第 9 章标识了某些安全性解决方案的某些不理想的副作用，以及在使用这些解决方案时需要加以注意的事项
* 第 10 章总结了此文档所覆盖的不同的安全性解决方案领域
* 附录 A 提供了此文档中所使用的首字母缩略词的定义，以及
* 附录 B 包含参考文献的列表

