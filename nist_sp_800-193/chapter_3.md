# 第 3 章 原理和关键概念

本章为平台弹性的指导原则提供了简要的描述，它们为此文档中的指导意见提供了基础。本章还讨论了用于整篇文档的主要架构方面的概念和考虑。

## 3.1 支持平台弹性的原则

此文档中的安全性指导意见基于下列三个原则：

* **保护**：

    保证平台固件代码和关键数据处于某种具有完整性的状态，并且受到保护以防止损坏的机制，诸如保证固件更新的合法性和完整性的过程

* **检测**：

    检测平台固件代码和关键数据于何时发生损坏或者从某种授权的状态发生更改的机制

* **恢复**：

    用于将平台固件代码和关键数据恢复至某种具有完整性的状态的机制，如果任何上述代码或者关键数据被检测为发生损坏，或者如果被迫通过某种授权机制来进行恢复。恢复被限制为恢复固件代码和关键数据的能力

第 4 章的技术指导意见围绕这些原则进行组织。第一个原则，保护，其范围和目的类似于 NIST SP 800-147，_BIOS 保护指南_ \[1\] 中的指导意见。关于保护的基本原则在此文档中得到扩展以适用于平台中的更为宽泛的一组固件和配置数据。

尽管保护机制的本意是防止针对平台固件和关键数据的破坏性和恶意攻击，这些机制在所有类别的设备上的实现可能不完美或者不现实。在这些情况下，检测和恢复机制的本意是发现并且化解攻击，从而重新得到设备的正常和安全的运行。

## 3.2 弹性属性

此文档中的技术指导意见根据针对单个平台设备的指导意见而写作，以使得它们广泛适用于一系列设备、平台和系统。抛开对于设备的狭窄专注，此文档的本意是通过保证底层平台具有弹性从而建立起支持系统整体弹性以对抗破坏性攻击的指导意见。

平台可能不能为其所有平台设备完整地提供保护、检测和恢复能力。哪怕只是一个设备的功能丧失也可能足以使得整个系统永久性地不能运作，如果该特别设备在启动或者运行平台中具有关键作用。作为一个整体的平台若要称其为具有对抗破坏性攻击的弹性，其中对于最小限度地恢复系统运作所必需的，以及足以恢复系统的合理的功能的那一组平台设备，其本身应该是具有弹性的。我们称这组设备为 _关键平台设备_。特定的弹性属性可能因平台而异。

* _受保护的_

    平台若要被看作 _受保护的_，所有关键平台设备必须满足 4.1 和 4.2 节的保护指导意见，但可以不完全地提供恢复设备地固件和/或关键数据的能力

* _可恢复的_

    平台若要被看作 _可恢复的_，所有关键平台设备必须提供 4.1 和 4.3 节所描述的检测损坏的方法，并且提供满足 4.1 和 4.4 节的指导意见的从损坏中恢复的方法

* _具有弹性的_

    平台若要被看作 _具有弹性的_，所有关键平台设备必须满足第 4 章的所有指导意见。非关键设备也应该满足这些要求，或者至少是如此设计的，即针对这些设备之一的攻击不会影响作为整体的平台的安全性。具有弹性的平台将会尝试防止那些能够干扰平台正确运行的攻击，同时还能提供机制以检测所发生的恶意或者意外的问题并且从中恢复

## 3.3 可信根和信任链

此文档中所描述的安全机制建立在可信根（RoT）之中。可信根是构成了提供一项或者多项诸如测定、存储、报告、恢复、验证和更新等具体针对安全性的功能的基础的元素。RoT 必须被设计为总是以预期的方式运作，由于它的恰当运作对于提供它的具体针对安全性的功能至关重要，并且由于它的不当行为不能被检测到。RoT 通常是信任链（CoT）中的首个元素，并且可以作为这样一条信任链中的锚点，以提供更加复杂的功能。RoT 的责任和能力可以完全在 RoT 内部实现，也可以利用通过一条植根于 RoT 的信任链由其 RoT 衍生的代理来执行。例如，当某个恢复代理（RTRec）被触发时，它将会通过启动另一个元素来引发恢复过程，该元素确定一种适当的恢复序列并且启动一连串的后续元素以执行恢复操作。图 2 提供了关于信任链如何从某个初始 RoT 建立的高层级描述。

通常，后续元素在维持由 RoT 开始的信任链中具有协助性。信任链中的组件具有提升的权限以执行安全性关键任务，诸如执行那些对于不那么受信任的软件不可用的设备更新。RoT 和 CoT 可以拥有机制以放下这些权限，一旦其安全功能执行完毕，或者如果该安全功能被确定为非必要。CoT 也可以在将控制权移交给某个非协助性的元素之前放下这些权限。

由于 RoT 对于提供关键安全功能至关重要，它们需要在设计上是安全的。确定 RoT 的可信度方面的主要考虑包括对于 RoT 的攻击面的分析，以及对于用于保护该攻击面的化解方法的评估。确保 RoT 的可信度是提供可信根的厂商的责任。厂商通常通过使得 RoT 不可变，或者通过保证在针对 RoT 的任何更新的完整性和合法性得到验证之后才执行这样的更新来保护它们。通常，RoT 运行在隔离环境中，并且运行在高于任何可能修改它的事物的权限等级之上，并且/或者能够在任何事物可能修改它们之前完成其功能，以保证其他设备不能在操作过程中攻击其行为。

此文档的 4.1 节提供了关于支持平台弹性的 RoT 的能力和属性的具体指导意见。

平台通常由大量设备组成，通常在设备以及不同制造商之间存在隔离边界。一个平台可能需要多个独立的 RoT 和 CoT 以提供对于弹性的完整覆盖。例如，硬盘控制器可能拥有不同于宿主平台的独立微控制器和固件。硬盘控制器和宿主平台可能都需要其各自独立的恢复信任链，如果它们各自的关键数据损坏。

## 3.4 设备关系

由于缺少能力或者功能，某些平台设备可能并不拥有它们自己的可信根以执行更新、检测或者恢复。我们将需要协助的设备称为共生设备，而将提供协助的设备称为宿主设备。依赖关系可以被如此确立，如果宿主设备和共生设备可以共同满足保护、检测和/或恢复的指导意见，而共生设备不能独立满足这些要求。这样的依赖关系可以撬动安全通讯信道或者其他技术。为了能够高效地提供协助，宿主设备需要自身满足那些关于它们所协助传递给共生设备的机制的指导意见。合在一起，宿主和共生设备提供了一条用于实现保护、检测和/或恢复的安全性指导意见的 CoT。

设备之间可能存在这样的关系，这里的信任是隐式的——即这种信任由系统架构来提供。一个设备可以从另一个设备接收关于无歧义的物理存在的指示，在此，一种隐式的信任关系已经存在。另一个设备通过可信路径发送消息这一事实意味着此设备可以信任该请求。

图 3 中的示意图显示了共生设备和宿主之间的关系的不同方面；这种关系可以位于隔离边界内部，或者跨越隔离边界、跨越设备。它还显示了在具有多个可信根、多条信任链以及多条通讯路径的情况下，不同的设备可以如何共存。

可能还存在其他关系，它们既不暗示也不要求任何信任级别。考虑一个负责接收更新的设备。该设备可以随后将这些更新传递至其他设备。由于每个设备（或者连同其宿主设备的共生设备）负责验证其自身的更新，在发布更新的设备和被提供这些更新的设备之间没有信任要求。

## 3.5 固件更新机制

固件保护指导意见的核心原则是保证只有合法并且经过授权的固件更新镜像可以被应用到平台设备。如果来源（例如设备、系统制造商或者其他经过授权的实体）和完整性可以被成功验证，则称此更新镜像为合法的。在应用更新之前验证镜像的技术过程称为 _认证更新机制_。

而授权则是许可执行某个更新的过程。尽管认证过程通常植根于设备或者系统制造商，执行更新的授权过程通常植根于设备或者系统所有者。

### 3.5.1 认证更新机制

认证更新机制利用数字签名以保证固件更新镜像的合法性。利用认证更新机制更新固件镜像依赖更新可信根（RTU），它包含一种签名验证算法和一个密钥存储器，该密钥存储器包含验证固件更新镜像的签名所需的公钥。此密钥存储器和签名验证算法以某种受保护的方式存储于计算机系统上，并且仅可通过使用认证更新机制或者安全本地更新机制来修改。

RTU 中的密钥存储器包含用于验证固件更新镜像的签名的公钥 \[7\] 或者包含该公钥的散列值 \[6\]，如果该公钥由固件更新镜像提供。在后一种情况下，更新机制计算由固件更新镜像提供的公钥的散列值，并且保证它和出现在密钥存储器中的某个散列值相匹配，然后才会使用提供的公钥来验证固件更新镜像的签名。

密钥存储器中的与该公钥对应的私钥有可能受到“攻击”，例如，该私钥被盗并且被曝光，获得此密钥的访问权限的攻击者可以签名无效固件，它可以损坏平台设备或者向平台中注入恶意软件。对于签名的恰当使用因此使得供货成为必需，以便从密钥攻击中恢复。一系列技术可用于从这些情况中恢复。范例可以复杂到包括密钥层级，也可以简单到包括在恢复（或者更新）镜像的其余部分时更新密钥存储器。

### 3.5.2 授权更新机制

系统及其支持管理软件和固件可以提供若干种授权机制以便合法地更新固件镜像。这些包括：

1. **由用户引发的更新**：厂商通常为最终用户提供能够更新固件镜像的工具。这可以是通过外部介质以执行这些更新，也可以是通过能够从用户的正常操作系统中更新固件镜像的工具。取决于系统上所实现的安全机制，这些工具可以直接更新固件镜像，或者它们可以安排在下次系统重启时更新。更新后的代码将会遇到由不同修订版本的代码写入的关键数据。更新后的代码应该保证平台继续正常工作，可以通过保持同关键数据兼容、通过更新关键数据以使其同更新后的代码兼容，或者至少是通过将关键数据的值重置为其默认值来实现。
2. **受管理的更新**：一台给定的计算机系统可能拥有基于硬件和软件的代理，它们允许系统管理员远程更新固件镜像而无需来自用户的直接介入。
3. **回滚**：在应用更新之前对其进行认证的实现可能也会在更新过程中检查版本号。在这些情况下，固件镜像可能拥有一种特殊的更新过程，用于将已安装的固件回滚至某个早期版本。例如，回滚过程可能要求用户的物理存在。此机制可以防止攻击者安装具有已知漏洞的老旧固件。
4. **手动恢复**：为了从损坏或者不能正常工作的固件中恢复，计算机系统可以提供机制以允许具有物理存在的用户在启动过程中将固件镜像替换为已知良好的版本和配置。
5. **自动恢复**：某些计算机系统能够检测固件镜像于何时损坏并且从存储在不同于损坏的镜像的位置（例如第二块闪存存储器芯片、存储设备的保护区域等）的备份固件镜像恢复。

### 3.5.3 安全本地更新

尽管此文档建议固件更新通过 3.5.1 节所描述的某种认证更新机制来实施，某些设备也可以支持一种安全本地更新机制。这些机制通过某种能够说明无歧义的物理存在的过程来替代授权固件更新。例如，安全本地更新机制可以被用于从某个不能利用认证更新或者自动恢复机制更新的损坏的固件镜像中恢复。安全本地更新机制也可被一位物理存在的管理员用于在一个不允许回滚的设备上将其更新至某个早期固件镜像。

为了防止远程攻击利用安全本地更新机制，这些机制验证用户是否已经物理授权该更新是至关重要的。诸如通过远程控制台同设备或者系统进行交互等远程机制不满足关于物理存在的要求。类似地，可以被运行在系统或者设备上的恶意软件伪造的机制不满足此要求。参见 3.6.2 节以获得更多细节。

然而请注意，实现了安全本地更新机制的设备潜在地易受来自恶意管理员的攻击，以及对该设备或者系统具有物理访问权限的其他攻击。额外的物理、环境和技术方面的安全性措施对于保护这些设备至关重要，但是这些超出了此文档的范围。

## 3.6 关于平台弹性的其他考虑

此文档并未解决购买者、用户或者 IT 管理员可能考虑到的属于平台网络弹性的某些其他考虑。关于这些其他考虑的不完全列表和讨论见下文。

### 3.6.1 管理

厂商在设计具有弹性的平台时应该仔细考虑它们的目标客户，以保证恰当的管理和控制策略以及配置设置能够以最好地服务于客户要求的方式来管理。策略和配置设置的管理可以在本地或者远程进行。取决于平台类型，客户可能期望安全地从远程位置完整地管理平台的能力。某些客户可能期望要求物理存在的用户批准策略更改。其他客户可能期望能够远程提取任何日志数据，或者它们可能希望阻止提取日志数据，除非通过授权的本地机制。

### 3.6.2 授权机制

某些恢复和管理操作可能对平台固件或者软件作出重大修改。例如，固件设置可以控制启动顺序，而软件恢复代理可能还原一份备份而删除最近创建的数据。修改这些设置可能要求平台层级的授权以表明请求此更改的实体被授权如此做。对于某些环境，诸如大型组织机构或者数据中心，专业平台管理员可以利用提供给管理平台用的凭证来远程授权操作。在其他环境中，例如消费者或者小型企业，可能没有远程平台管理员。然而某些系统可能拥有可以本地使用的平台管理员凭证。或者，某些系统可以允许用户主张平台层级的授权，通过确保物理存在的用户发出命令或者请求更改。在这些系统上，平台必须无歧义地验证物理存在的用户授权了此操作。如果正确处理，恶意软件不能伪造涉及来自物理存在的用户的确认的授权检查。我们使用“无歧义的物理存在”这一词语来指示不能被恶意软件伪造的本地用户。

无歧义的物理存在允许主张平台层级的授权（或者平台层级授权的一部分），通过表明此人正在同设备或者平台进行物理交互。通过保证恢复操作或者关键数据更改得到了物理存在的人员的授权，无歧义的物理存在提供了一种本意是要防止恶意软件的影响的管理路径。

创建能够恰当和可靠地验证来自物理存在的人员的确认的平台和设备是复杂的。专用的物理按钮或者硬件跳线可以提供一种相对直接和显式的方法，以此表明物理存在。平台设计或者部署方面的考虑可以防止某人拥有直接物理机制以便同每一个支持某种依赖无歧义的物理存在的功能的设备进行交互。在这些情况下，需要在用于验证无歧义的物理存在的机制和将要以管理员的名义执行操作的设备之间存在一条可信路径。为了满足此文档后面提到的不可绕过性的指导意见，这条可信路径，它可能包括输入/输出设备（例如人体学接口设备、显卡等）和内部总线，需要被保护以防止其被恶意软件操控。

有一系列技术可以在验证无歧义的物理存在的物理机制和平台或者设备之间提供可信路径。一个范例可能是仅当平台可以被信任为处于某种具有完整性的状态，先于恶意软件可能干扰这些过程，诸如在启动过程的早期，才可以接受或者确认来自物理存在的人员的命令。在其他情况下，系统架构可能会在服务处理器（例如 EC、BMC）和其他平台设备之间提供可信路径。

依赖无歧义的物理存在而非平台管理员凭证以授权管理操作的设备可能易受具有该设备的物理访问权限的个人的攻击。因此它的应用可能不适合于缺少强物理安全性的应用或者环境。

### 3.6.3 网络辅助恢复 vs. 本地恢复

在大多数情况下，通过本地从损坏中恢复的能力将会是最为简便的，能够提供最高等级的客户满意度，并且可能是必需的，如果没有网络连接性。然而公认的是，这并非总是可能的，特别是鉴于众多设备所具有的存储限制。在本地恢复不可能的情况下，网络辅助恢复可以被实现，如果以某种安全并且可信的方式实施，这可能包括使用加密、数字签名、安全传输方法等。尽管本地或者网络辅助的恢复都是可接受的实现机制，一台设备同时支持二者的能力提供了更高级别的弹性，因而是推荐的。

### 3.6.4 自动恢复 vs. 手动恢复

恢复可以通过三种方式之一进行：

1. _完全自动_——引发恢复或者在恢复过程中无需用户交互
2. _部分自动_——自动引发恢复，但是在恢复过程中的某些时间点要求用户交互
3. _手动_——要求用户交互以引发恢复

完全自动恢复机制可能被某些用户所偏好，由于它可以在发生大范围攻击时允许更快速的大规模恢复。

完全自动恢复可能并不被所有系统支持，或是所有用户都想要的。例如，系统可能要求管理员凭证或者授权以继续恢复过程。

手动恢复可能被某些用户所偏好，以使得平台管理员被告知发生了某些错误，然后等待管理员决定接下来将要采取何种步骤。这可能也会有用，如果平台管理员希望捕获信息以帮助取证分析。

由管理员定义的策略通常定义了手动恢复的行为和权限要求。这样的策略可能也会影响自动恢复。例如，一条由管理员定义的策略可能会限制在恢复过程中可以被安装的固件版本。设置恢复策略者必须谨慎行事。策略中所设置的固件版本可能刚好就是被成功攻击从而使得恢复成为必需的版本。简单地重写易受攻击的版本可能导致攻击/恢复的循环。

策略本身也可能成为攻击目标，因此，恢复实现的设计必须说明该策略不可用的可能性。同时，由于恢复可能是多步骤的过程，一条将会在恢复过程结束时被满足的策略要求可能在中间步骤过程中未被满足。

重写固件镜像的恢复方案可能会在恢复过程中破坏那些将会有助于分析攻击的证据。恢复方案应该在可行的情况下提供方法以保留或者记录被攻击的镜像以及其他信息，在那些恢复固件时可能会丢失该信息的情况下。

### 3.6.5 事件日志

记录固件和恢复相关事件的日志通常可能有助于多种目的，包括但不限于：

* 允许系统的平台管理员捕获关于可能导致针对平台的攻击或者实际平台攻击的信息的取证分析。这可能有助于确定平台是否可能包含未知安全漏洞，或者理解是否可能存在具有类似性质的大规模攻击。
* 提供一条审计路径以获知某一事件于何时发生，以及某次更新或者恢复是否得到授权、由谁授权以及何时授权。

平台和设备制造商需要决定它们的系统可能要求何种级别的事件日志记录，为这些系统考虑预想中的用户环境。记入日志的事件应该以一种能够提供对其完整性的担保，并且允许日志事件的安全恢复和传输的方式来记录。必须谨慎行事以保证对事件日志的访问权限受到控制。非授权的人员可以利用事件日志数据分析以拓宽攻击面。

