# 第 4 章 防护工具和范例

## 4.1 工具：用于 UEFI、BIOS、SMM 和 ACPI 的 CHIPSEC

CHIPSEC 是由 Intel 安全高级威胁研究（Intel Security Advanced Threat Research）开发的开源软件，并且是平台固件安全领域中的权威解决方案之一。CHIPSEC 不仅允许转储固件镜像并且计算散列值，并且可以对复杂 UEFI 平台固件上的可加载模块、变量及其他攻击面进行深度检测。CHIPSEC 提供了深度测试套件，包括诸如模糊测试等蛮力安全技术。尽管 CHIPSEC 非常完整，它是高度依存于架构的，并且只在最近十几年生产的 Intel x86/x86\_64 主板上工作得最好。

CHIPSEC 是一款任何整合或者贩卖基于 Intel 的系统的人都应该使用的工具，甚至一直到任何包装他们自己的系统的零售商。尽管不能指望百思买开箱一台来自 OEM 的系统并且在出售前使用 CHIPSEC 对其进行测试，VAR 应该能够验证一台全新的系统能够通过所有 CHIPSEC 测试。这不是当今所发生的事情，但却属于您作为购买（或者提供购买指南）者对于众多系统所能够坚持要求的事情。

CHIPSEC 可以用于在线和离线分析。如需进行离线分析，则需要一块 ROM 的副本（通常称为 _ROM.bin_ 文件）。CHIPSEC 可以生成 _ROM.bin_ 文件以用于离线分析，但是其他工具诸如 FlashROM、Google Pawn 和苹果的 eficheck 也可以。

CHIPSEC 是关于软件应该对于所有平台固件，尤其是那些设计为可更新而非烧入 ROM 的固件可用（以及开源）的一个良好范例。

## 4.2 工具：PCIe

对于 PCIe 固件而言，解决方案的选项开始变得杂乱。大多数 PCIe 固件称为“选项 ROM”或者“扩展 ROM”，并且如同它们的名称所暗示的那样，对于相对简单的 PCIe 板卡，它们通常是 ROM 芯片，并且只能通过完整地更换芯片来更新。对于系统的物理访问对于执行此类攻击是必需的。

随着系统变得更加集成化，诸如扩展卡之类的 PCIe 设备以及雷电设备抬高了价值链，并且成为了更加复杂的设备，通常具有可由软件更新的 ROM。无人愿意仅仅由于初始化 ROM 或者通常是复杂的设备操作固件中的一处代码错误就扔掉一块价值 1000 美元的 GPU。

在使用 Linux 时，可以利用 _lspci_ 检查 PCIe 总线，以及利用 _sysfs_ 转储 PCIe 选项 ROM。并且 Linux 上的 _fwupd_ 和 Windows Update 固件更新是受管理的系统提供自动更新的开始。但是请注意，这些方法可能还远远谈不上完整——用以保证 GPU 在启动时能够工作的选项 ROM 只是现代 GPU 上的固件的很小一部分。当前只有来自 GPU 厂商的私有工具能够处理现代 GPU 上的固件，这也适用于网卡和 RAID 适配器。

## 4.3 更多工具

更多工具列出于我们的附录 _Awesome Firmware Security_ 中，这是一部进化中的文档，因此请确保阅读它的最新版本以紧跟时代发展，或者考虑订阅更新。

# 第 5 章 帮助为每一个人改进固件安全性

作为一名系统管理员，或者其他 IT 业务的专业人士，您拥有独特的地位以在整个 IT 行业中改进固件安全性。当然，您可以并且应该帮助提升警觉性，以便在出现机会的时候教育同行 IT 专业和管理人士——也许甚至是通过分享本书。然而，撬动变革的最有力的杠杆还是您所持有的购买力。没有一位个人消费者可以同系统 VAR 和 OEM 进行那种您在常规基础上就能与之进行的对话。您所遇到的一般销售人员不一定能够明白您正在说什么，但是对于大多数采购，您将会有机会遇到一位更加技术型的销售工程师。这是您作为系统管理员的责任以引导您的雇主朝向最佳的 IT 采购方案，这也许不一定是可选项之中最便宜的。这是您的职责以平衡这其中涉及的所有因素，即高额采购是您的雇主的主要资本花费，而它将会被您的同事雇员使用多年。

我们在本书中所倡导的全部就是您应该考虑将硬件和固件层级的安全性作为众多购买决定因素之一，并且相应地询问问题以及利用杠杆对抗您的厂商。考虑向看重固件安全性的其他厂商开放您的流程，这些厂商可以采用提供校验散列值、通过标准化的机制（Windows Update _和_ LVFS fwupd）提供经过签名的更新，以及完全开源等方式。至少也要表达出对于您当前的厂商的硬件中所包含的所有闭源、不可验证的固件组件的担忧。

与 IT 专业人士所面临的众多问题相似，您也许不能一下子就为您自己的职业生涯或者工作环境带来改观。但是您可以为将来世界各地的 IT 专业人士，或者更宽泛地，为每个人作出一些积极的改变。今天也许没有这样的系统可供您购买，它们为其自带的所有固件完整地提供了软件工具、可验证性和安全性。但这并不一定还是若干年之后的情况。

制造商和 OEM 面临它们自身的挑战，其中最大的挑战就是计算机硬件的非常微薄的剩余价值。所有进步在某种程度上都必须从这些微薄的剩余价值中榨取。固件展现出了一个特别的挑战，由于制造商不愿意在其售出一台系统之后再次接触它，因此就地更新应当被支持。如果您开始要求变革，很可能会遇到一些挫折，但是仍然值得为之付出努力，并且这应当在您的剩余 IT 职业生涯中为您和您的同行 IT 专业人士带来回报。

# 第 6 章 结论

平台固件为攻击者提供了一个平台以便在当前传统的反病毒和恶意软件检测软件的视觉之外安装持久的恶意软件。固件的复杂度和能力不断增加，因此攻击面也在增加，而关于此问题的警觉性仍然较低。

作为一名系统或者网络管理员，或者一名蓝队成员，您已经提高了对此问题的警觉性，现在您可以帮助教育其他人，开始实现防护，以及向您的 VAR 和 OEM 施压以得到更加符合安全性的硬件。

## 6.1 PreOS Security 的安全性解决方案

第一步是在开箱之后立即将所有可能的平台固件的镜像及其散列值整合到您的硬件生命周期，并且在机器的寿命之内周期性地进行检查，特别是在疑似遭到物理攻击或者操作系统级别的恶意软件入侵之后。PreOS Security 通过我们的软件客户端和网络仪表盘使得这一过程更加简单了，并且我们将会与您一同工作以便将我们的客户端与您的单窗格选择系统整合到一起。

您也可以与固件安全领域的最新发展保持同步，通过我们的季度新闻简报中的一段简短总结：

[https://preossec.com/newsletter](https://preossec.com/newsletter)

我们将会持续精炼本书的内容，因此如果您有任何反馈，通过以下邮件地址发送给我们：

editor@preossec.com

